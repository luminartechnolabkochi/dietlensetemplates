<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verify Your Email - Diet Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
</head>
<body>
    <div class="auth-container">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-6 col-lg-5">
                    <div class="auth-card fade-in">
                        <div class="auth-header text-center">
                            <div class="mb-3">
                                <div class="d-inline-flex align-items-center justify-content-center bg-primary bg-opacity-10 rounded-circle" style="width: 80px; height: 80px;">
                                    <i class="fas fa-envelope-open-text text-primary" style="font-size: 2rem;"></i>
                                </div>
                            </div>
                            <h2 class="mb-2">Verify Your Email</h2>
                            <p class="text-muted mb-0">We've sent a verification code to</p>
                            <p class="fw-bold text-primary mb-0">john.doe@example.com</p>
                        </div>
                        <div class="p-4">
                            <form method="post" id="otp-form">
                                <div class="mb-4">
                                    <label for="otp" class="form-label text-center w-100 mb-3">
                                        Enter the 6-digit code
                                    </label>
                                    <div class="d-flex justify-content-center gap-2">
                                        <input type="text" class="form-control text-center otp-input" 
                                               maxlength="1" style="width: 50px; height: 50px; font-size: 1.25rem; font-weight: bold;" 
                                               name="otp1" id="otp1" required>
                                        <input type="text" class="form-control text-center otp-input" 
                                               maxlength="1" style="width: 50px; height: 50px; font-size: 1.25rem; font-weight: bold;" 
                                               name="otp2" id="otp2" required>
                                        <input type="text" class="form-control text-center otp-input" 
                                               maxlength="1" style="width: 50px; height: 50px; font-size: 1.25rem; font-weight: bold;" 
                                               name="otp3" id="otp3" required>
                                        <input type="text" class="form-control text-center otp-input" 
                                               maxlength="1" style="width: 50px; height: 50px; font-size: 1.25rem; font-weight: bold;" 
                                               name="otp4" id="otp4" required>
                                        <input type="text" class="form-control text-center otp-input" 
                                               maxlength="1" style="width: 50px; height: 50px; font-size: 1.25rem; font-weight: bold;" 
                                               name="otp5" id="otp5" required>
                                        <input type="text" class="form-control text-center otp-input" 
                                               maxlength="1" style="width: 50px; height: 50px; font-size: 1.25rem; font-weight: bold;" 
                                               name="otp6" id="otp6" required>
                                    </div>
                                    <div class="invalid-feedback text-center mt-2" id="otp-error" style="display: none;">
                                        Please enter the complete verification code.
                                    </div>
                                </div>
                                
                                <!-- Timer Display -->
                                <div class="text-center mb-4">
                                    <div class="d-inline-flex align-items-center justify-content-center bg-light rounded-pill px-3 py-2">
                                        <i class="fas fa-clock me-2 text-muted"></i>
                                        <span class="text-muted">Code expires in </span>
                                        <span class="fw-bold text-danger ms-1" id="timer">05:00</span>
                                    </div>
                                </div>
                                
                                <button type="submit" class="btn btn-primary w-100 mb-3">
                                    <i class="fas fa-check-circle me-2"></i>Verify Email
                                </button>
                            </form>
                            
                            <!-- Resend Code Section -->
                            <div class="text-center mb-3">
                                <div id="resend-section">
                                    <p class="text-muted mb-2">Didn't receive the code?</p>
                                    <button type="button" class="btn btn-link p-0 text-primary fw-bold" id="resend-btn">
                                        <i class="fas fa-redo me-1"></i>Resend Code
                                    </button>
                                </div>
                                
                                <div id="resend-success" style="display: none;">
                                    <div class="alert alert-success py-2 mb-2">
                                        <i class="fas fa-check-circle me-2"></i>New code sent successfully!
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Change Email Option -->
                            <div class="text-center border-top pt-3">
                                <p class="text-muted small mb-2">Wrong email address?</p>
                                <a href="signup.html" class="btn btn-outline-secondary btn-sm">
                                    <i class="fas fa-edit me-1"></i>Change Email
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Help Card -->
                    <div class="card mt-4 border-0 bg-light">
                        <div class="card-body text-center py-3">
                            <h6 class="card-title text-muted mb-2">
                                <i class="fas fa-question-circle me-2"></i>Having trouble?
                            </h6>
                            <p class="card-text text-muted small mb-2">
                                Check your spam folder or contact support if you don't receive the code
                            </p>
                            <a href="#" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-headset me-1"></i>Contact Support
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Success Modal -->
    <div class="modal fade" id="successModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0">
                <div class="modal-body text-center p-4">
                    <div class="mb-3">
                        <div class="d-inline-flex align-items-center justify-content-center bg-success bg-opacity-10 rounded-circle" style="width: 80px; height: 80px;">
                            <i class="fas fa-check-circle text-success" style="font-size: 2.5rem;"></i>
                        </div>
                    </div>
                    <h4 class="text-success mb-2">Email Verified!</h4>
                    <p class="text-muted mb-4">Your email has been successfully verified. You can now access your account.</p>
                    <button type="button" class="btn btn-success" onclick="window.location.href='profile-setup.html'">
                        <i class="fas fa-arrow-right me-2"></i>Continue to Setup
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Error Modal -->
    <div class="modal fade" id="errorModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0">
                <div class="modal-body text-center p-4">
                    <div class="mb-3">
                        <div class="d-inline-flex align-items-center justify-content-center bg-danger bg-opacity-10 rounded-circle" style="width: 80px; height: 80px;">
                            <i class="fas fa-times-circle text-danger" style="font-size: 2.5rem;"></i>
                        </div>
                    </div>
                    <h4 class="text-danger mb-2">Verification Failed</h4>
                    <p class="text-muted mb-4">The code you entered is incorrect or has expired. Please try again.</p>
                    <div class="d-grid gap-2">
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">
                            <i class="fas fa-redo me-2"></i>Try Again
                        </button>
                        <button type="button" class="btn btn-outline-secondary" id="resend-from-modal">
                            <i class="fas fa-paper-plane me-2"></i>Resend Code
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Note: The following JavaScript is for demonstration purposes only -->
    <!-- In actual Django implementation, replace with server-side logic -->
    <script>
        // OTP Input Handling (Auto-focus next input)
        const otpInputs = document.querySelectorAll('.otp-input');
        
        otpInputs.forEach((input, index) => {
            input.addEventListener('input', (e) => {
                const value = e.target.value;
                
                // Only allow numbers
                if (!/^\d$/.test(value) && value !== '') {
                    e.target.value = '';
                    return;
                }
                
                // Auto-focus next input
                if (value && index < otpInputs.length - 1) {
                    otpInputs[index + 1].focus();
                }
                
                // Clear error state
                document.getElementById('otp-error').style.display = 'none';
                otpInputs.forEach(inp => inp.classList.remove('is-invalid'));
            });
            
            // Handle backspace
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Backspace' && !e.target.value && index > 0) {
                    otpInputs[index - 1].focus();
                }
            });
            
            // Handle paste
            input.addEventListener('paste', (e) => {
                e.preventDefault();
                const pasteData = e.clipboardData.getData('text').replace(/\D/g, '');
                
                for (let i = 0; i < Math.min(pasteData.length, otpInputs.length - index); i++) {
                    if (index + i < otpInputs.length) {
                        otpInputs[index + i].value = pasteData[i];
                    }
                }
                
                // Focus the next empty input or the last filled input
                const nextEmpty = [...otpInputs].findIndex((inp, i) => i > index && !inp.value);
                const focusIndex = nextEmpty !== -1 ? nextEmpty : Math.min(index + pasteData.length, otpInputs.length - 1);
                otpInputs[focusIndex].focus();
            });
        });
        
        // Timer countdown (5 minutes = 300 seconds)
        let timeLeft = 300;
        const timerElement = document.getElementById('timer');
        
        function updateTimer() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            if (timeLeft <= 0) {
                timerElement.textContent = '00:00';
                timerElement.classList.remove('text-danger');
                timerElement.classList.add('text-muted');
                
                // Disable form and show expired message
                const form = document.getElementById('otp-form');
                const inputs = form.querySelectorAll('input');
                inputs.forEach(input => input.disabled = true);
                
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-clock me-2"></i>Code Expired';
                
                return;
            }
            
            if (timeLeft <= 60) {
                timerElement.classList.add('text-danger');
            }
            
            timeLeft--;
        }
        
        // Start timer
        const timerInterval = setInterval(updateTimer, 1000);
        updateTimer();
        
        // Form submission
        document.getElementById('otp-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get OTP value
            const otpValue = Array.from(otpInputs).map(input => input.value).join('');
            
            // Validate OTP
            if (otpValue.length !== 6) {
                document.getElementById('otp-error').style.display = 'block';
                otpInputs.forEach(input => input.classList.add('is-invalid'));
                return;
            }
            
            // Simulate verification process
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Verifying...';
            
            // Simulate API call
            setTimeout(() => {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
                
                // For demonstration - show success for code "123456", error for others
                if (otpValue === '123456') {
                    clearInterval(timerInterval);
                    new bootstrap.Modal(document.getElementById('successModal')).show();
                } else {
                    new bootstrap.Modal(document.getElementById('errorModal')).show();
                    // Clear inputs
                    otpInputs.forEach(input => {
                        input.value = '';
                        input.classList.add('is-invalid');
                    });
                    otpInputs[0].focus();
                }
            }, 2000);
        });
        
        // Resend code functionality
        function resendCode() {
            const resendBtn = document.getElementById('resend-btn');
            const resendSection = document.getElementById('resend-section');
            const resendSuccess = document.getElementById('resend-success');
            
            // Show loading state
            resendBtn.disabled = true;
            resendBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-1"></span>Sending...';
            
            // Simulate resend API call
            setTimeout(() => {
                // Reset timer
                timeLeft = 300;
                timerElement.classList.remove('text-muted');
                timerElement.classList.add('text-danger');
                
                // Re-enable form
                const form = document.getElementById('otp-form');
                const inputs = form.querySelectorAll('input');
                inputs.forEach(input => {
                    input.disabled = false;
                    input.classList.remove('is-invalid');
                    input.value = '';
                });
                
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-check-circle me-2"></i>Verify Email';
                
                // Show success message
                resendSection.style.display = 'none';
                resendSuccess.style.display = 'block';
                
                // Focus first input
                otpInputs[0].focus();
                
                // Hide success message after 3 seconds and show resend button again
                setTimeout(() => {
                    resendSuccess.style.display = 'none';
                    resendSection.style.display = 'block';
                    resendBtn.disabled = false;
                    resendBtn.innerHTML = '<i class="fas fa-redo me-1"></i>Resend Code';
                }, 3000);
                
            }, 1500);
        }
        
        // Attach resend handlers
        document.getElementById('resend-btn').addEventListener('click', resendCode);
        document.getElementById('resend-from-modal').addEventListener('click', function() {
            bootstrap.Modal.getInstance(document.getElementById('errorModal')).hide();
            resendCode();
        });
        
        // Auto-focus first input on page load
        window.addEventListener('load', () => {
            otpInputs[0].focus();
        });
    </script>
</body>
</html>